<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒå£°ä¼ è¯‘ Â· å­—å¹•æŸ¥çœ‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            height: 100dvh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* â•â•â• ç™»å½•é¡µ â•â•â• */
        .login-page {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 100dvh;
            background: linear-gradient(160deg, #1a1a2e 0%, #16213e 45%, #0f3460 100%);
            padding: 72px 32px 52px;
        }

        .login-hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
            text-align: center;
        }

        .login-logo-icon {
            width: 88px;
            height: 88px;
            background: linear-gradient(135deg, #1890FF, #6c63ff);
            border-radius: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: 0 14px 36px rgba(24,144,255,0.45);
        }

        .login-app-name {
            font-size: 30px;
            font-weight: 700;
            color: white;
            letter-spacing: 2px;
        }

        .login-tagline {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
            line-height: 1.7;
        }

        .login-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            margin-top: 4px;
        }

        .login-card {
            width: 100%;
        }

        .login-sso-btn {
            width: 100%;
            height: 54px;
            background: linear-gradient(135deg, #1890FF, #6c63ff);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 28px rgba(24,144,255,0.4);
            transition: transform 0.15s, opacity 0.15s;
        }

        .login-sso-btn:active { transform: scale(0.97); opacity: 0.9; }

        .login-hint {
            text-align: center;
            font-size: 12px;
            color: rgba(255,255,255,0.3);
            margin-top: 14px;
        }

        /* â•â•â• ä¸»ç•Œé¢éª¨æ¶ â•â•â• */
        .main-page {
            display: none;
            flex-direction: column;
            height: 100dvh;
            background: #1a1a1a;
        }

        /* â•â•â• é¡¶éƒ¨æ  â•â•â• */
        .topbar {
            height: 52px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 14px;
            flex-shrink: 0;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            position: relative;
            z-index: 10;
        }

        .topbar-logo {
            display: flex;
            align-items: center;
            gap: 7px;
            cursor: pointer;
            user-select: none;
        }

        .topbar-logo-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #1890FF, #6c63ff);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
        }

        .topbar-logo-text {
            font-size: 15px;
            font-weight: 700;
            color: rgba(255,255,255,0.9);
        }

        .topbar-center {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* é¢‘é“å· badge */
        .channel-badge {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.75);
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
        }

        .channel-badge:active { opacity: 0.7; }
        .channel-badge-label { opacity: 0.6; }
        .channel-badge-value { font-weight: 700; letter-spacing: 0.5px; color: white; }

        .topbar-right { display: flex; align-items: center; gap: 8px; }

        /* é€€å‡ºæŒ‰é’®ï¼ˆé€šè¯ä¸­ï¼‰*/
        .exit-btn {
            display: none;
            height: 30px;
            padding: 0 12px;
            background: rgba(255,77,79,0.15);
            border: 1px solid rgba(255,77,79,0.35);
            border-radius: 14px;
            color: #ff7875;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }
        .exit-btn.show { display: block; }
        .exit-btn:active { opacity: 0.75; }

        /* â”€â”€ è®¾ç½®æŒ‰é’® & ä¸‹æ‹‰èœå• â”€â”€ */
        .settings-wrap {
            position: relative;
        }

        .settings-btn {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(255,255,255,0.08);
            color: rgba(255,255,255,0.75);
            font-size: 17px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.15s;
            flex-shrink: 0;
        }
        .settings-btn:active { background: rgba(255,255,255,0.15); }

        .settings-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: #1e2233;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 14px;
            overflow: hidden;
            min-width: 180px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.45);
            z-index: 500;
        }
        .settings-dropdown.open { display: block; }

        .settings-dropdown-section {
            padding: 10px 14px 6px;
            font-size: 11px;
            color: rgba(255,255,255,0.3);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .settings-lang-row {
            display: flex;
            align-items: center;
            gap: 0;
            margin: 0 12px 10px;
            background: rgba(255,255,255,0.06);
            border-radius: 10px;
            overflow: hidden;
        }

        .settings-lang-btn {
            flex: 1;
            padding: 7px 0;
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            color: rgba(255,255,255,0.38);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
        }
        .settings-lang-btn.active {
            background: rgba(24,144,255,0.3);
            color: #69b1ff;
            border-radius: 8px;
        }

        .settings-divider {
            height: 1px;
            background: rgba(255,255,255,0.07);
            margin: 0 12px;
        }

        .settings-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 13px 16px;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.75);
            font-size: 14px;
            cursor: pointer;
            text-align: left;
            transition: background 0.15s;
        }
        .settings-dropdown-item:active { background: rgba(255,255,255,0.06); }
        .settings-dropdown-item.danger { color: #ff7875; }
        .settings-dropdown-item .item-icon { font-size: 16px; width: 20px; text-align: center; }

        /* â•â•â• åŠ å…¥å‰çš„ç©ºç™½çŠ¶æ€ â•â•â• */
        .join-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px 28px;
            gap: 0;
        }

        .join-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .join-title {
            font-size: 20px;
            font-weight: 700;
            color: rgba(255,255,255,0.85);
            margin-bottom: 8px;
            text-align: center;
        }

        .join-desc {
            font-size: 14px;
            color: rgba(255,255,255,0.4);
            text-align: center;
            line-height: 1.6;
            margin-bottom: 36px;
        }

        /* æ‰«ç åŒºåŸŸ */
        .qr-scanner-frame {
            width: 220px;
            height: 220px;
            position: relative;
            margin-bottom: 36px;
        }

        .qr-scanner-inner {
            width: 100%;
            height: 100%;
            border-radius: 20px;
            background: rgba(255,255,255,0.04);
            border: 1.5px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        /* å››è§’è£…é¥° */
        .qr-corner {
            position: absolute;
            width: 24px;
            height: 24px;
            border-color: #1890FF;
            border-style: solid;
        }

        .qr-corner.tl { top: 10px; left: 10px; border-width: 3px 0 0 3px; border-radius: 4px 0 0 0; }
        .qr-corner.tr { top: 10px; right: 10px; border-width: 3px 3px 0 0; border-radius: 0 4px 0 0; }
        .qr-corner.bl { bottom: 10px; left: 10px; border-width: 0 0 3px 3px; border-radius: 0 0 0 4px; }
        .qr-corner.br { bottom: 10px; right: 10px; border-width: 0 3px 3px 0; border-radius: 0 0 4px 0; }

        /* æ‰«æçº¿ */
        .qr-scan-line {
            position: absolute;
            left: 14px;
            right: 14px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #1890FF, transparent);
            animation: scanLine 2s ease-in-out infinite;
        }

        @keyframes scanLine {
            0% { top: 14px; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: calc(100% - 14px); opacity: 0; }
        }

        .qr-scan-icon {
            font-size: 56px;
            opacity: 0.18;
        }

        .scan-btn {
            width: 100%;
            max-width: 280px;
            height: 54px;
            background: linear-gradient(135deg, #1890FF, #6c63ff);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: opacity 0.15s, transform 0.15s;
            box-shadow: 0 8px 24px rgba(24,144,255,0.35);
        }

        .scan-btn:active { opacity: 0.85; transform: scale(0.97); }

        .scan-btn-icon { font-size: 20px; }

        /* è¯­è¨€åˆ‡æ¢æŒ‰é’® */
        .lang-toggle {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 20px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .lang-toggle-btn {
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 600;
            color: rgba(255,255,255,0.4);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
        }

        .lang-toggle-btn.active {
            background: rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.9);
        }

        /* ç™»å½•é¡µè¯­è¨€åˆ‡æ¢ */
        .login-lang-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 20px;
            overflow: hidden;
        }

        .login-lang-btn {
            padding: 5px 12px;
            font-size: 12px;
            font-weight: 600;
            color: rgba(255,255,255,0.45);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
        }

        .login-lang-btn.active {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        /* â•â•â• å­—å¹•åŒº â•â•â• */
        .subtitle-screen {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .subtitle-screen.active {
            display: flex;
        }

        /* å­—å¹•å·¥å…·æ  */
        .subtitle-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 14px;
            background: rgba(0,0,0,0.5);
            border-bottom: 1px solid rgba(255,255,255,0.06);
            flex-shrink: 0;
        }

        .subtitle-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: rgba(255,255,255,0.4);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #52c41a;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        /* æ˜¾ç¤ºæ¨¡å¼ pill */
        .display-pill {
            display: flex;
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 2px;
        }

        .display-pill-btn {
            padding: 4px 10px;
            border: none;
            background: transparent;
            color: rgba(255,255,255,0.45);
            font-size: 11px;
            border-radius: 6px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.15s;
        }

        .display-pill-btn.active {
            background: rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.9);
        }

        /* å­—å¹•åˆ—è¡¨ */
        .subtitle-list {
            flex: 1;
            overflow-y: auto;
            padding: 12px 0 16px;
            -webkit-overflow-scrolling: touch;
        }

        .subtitle-item {
            padding: 10px 14px;
            margin-bottom: 2px;
        }

        .subtitle-user-row {
            display: flex;
            align-items: center;
            gap: 7px;
            margin-bottom: 5px;
        }

        .subtitle-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }

        .subtitle-avatar img { width: 100%; height: 100%; object-fit: cover; }

        .subtitle-username {
            font-size: 12px;
            color: rgba(255,255,255,0.4);
            font-weight: 500;
        }

        .subtitle-time {
            font-size: 10px;
            color: rgba(255,255,255,0.2);
            margin-left: auto;
        }

        .subtitle-bubble {
            background: rgba(255,255,255,0.06);
            border-radius: 12px;
            padding: 10px 13px;
            margin-left: 31px;
        }

        .subtitle-original {
            font-size: 14px;
            color: rgba(255,255,255,0.75);
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .subtitle-translation {
            font-size: 13px;
            color: rgba(255,200,80,0.85);
            line-height: 1.5;
        }

        .subtitle-original-hidden .subtitle-original { display: none; }
        .subtitle-original-hidden .subtitle-translation { margin-top: 0; }

        /* â•â•â• åº•éƒ¨å®‰å…¨åŒºå ä½ â•â•â• */
        .safe-bottom {
            height: env(safe-area-inset-bottom, 0px);
            background: #1a1a1a;
            flex-shrink: 0;
        }

        /* â•â•â• Toast â•â•â• */
        .toast {
            position: fixed;
            bottom: calc(24px + env(safe-area-inset-bottom, 0px));
            left: 50%;
            transform: translateX(-50%) translateY(16px);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 13px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.28s;
            z-index: 9999;
            white-space: nowrap;
        }

        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .toast.success { background: rgba(82,196,26,0.9); }
        .toast.error { background: rgba(255,77,79,0.9); }
        .toast.warning { background: rgba(250,173,20,0.9); }

        /* â•â•â• äºŒç»´ç å¼¹çª— â•â•â• */
        .qr-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.75);
            z-index: 8000;
            align-items: flex-end;
            justify-content: center;
        }

        .qr-modal.show { display: flex; }

        .qr-modal-content {
            background: #1e1e2e;
            border-radius: 24px 24px 0 0;
            padding: 20px 24px calc(32px + env(safe-area-inset-bottom, 0px));
            width: 100%;
            text-align: center;
        }

        .qr-handle {
            width: 36px;
            height: 4px;
            background: rgba(255,255,255,0.15);
            border-radius: 2px;
            margin: 0 auto 20px;
        }

        .qr-title {
            font-size: 18px;
            font-weight: 700;
            color: white;
            margin-bottom: 6px;
        }

        .qr-subtitle {
            font-size: 13px;
            color: rgba(255,255,255,0.4);
            margin-bottom: 24px;
        }

        .qr-placeholder {
            width: 180px;
            height: 180px;
            background: white;
            border-radius: 16px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
            color: #333;
        }

        .qr-channel-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            color: rgba(255,255,255,0.5);
        }

        .qr-channel-value {
            font-size: 18px;
            font-weight: 700;
            color: white;
            letter-spacing: 1px;
        }

        .qr-close-btn {
            width: 100%;
            padding: 14px;
            background: rgba(255,255,255,0.08);
            color: rgba(255,255,255,0.75);
            border: none;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
        }

        /* â•â•â• å¼€å‘è€…æ¨¡å¼å¼¹çª— â•â•â• */
        .dev-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 9000;
            align-items: flex-end;
        }

        .dev-modal.active { display: flex; }

        .dev-content {
            background: #1e1e2e;
            border-radius: 24px 24px 0 0;
            padding: 24px 20px calc(28px + env(safe-area-inset-bottom, 0px));
            width: 100%;
        }

        .dev-handle {
            width: 36px;
            height: 4px;
            background: rgba(255,255,255,0.15);
            border-radius: 2px;
            margin: 0 auto 20px;
        }

        .dev-title {
            font-size: 18px;
            font-weight: 700;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .dev-option {
            padding: 14px;
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.04);
        }

        .dev-option-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .dev-option-title { font-size: 14px; font-weight: 500; color: rgba(255,255,255,0.85); margin-bottom: 3px; }
        .dev-option-desc { font-size: 12px; color: rgba(255,255,255,0.4); }

        .switch {
            width: 42px;
            height: 24px;
            background: #d9d9d9;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.25s;
            position: relative;
            flex-shrink: 0;
        }

        .switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.25s;
            box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        }

        .switch.active { background: #1890FF; }
        .switch.active::after { left: 20px; }

        .dev-close {
            width: 100%;
            margin-top: 12px;
            padding: 13px;
            background: rgba(255,255,255,0.06);
            color: rgba(255,255,255,0.6);
            border: none;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â• ç™»å½•é¡µ â•â•â•â•â•â•â•â•â•â• -->
<div class="login-page" id="loginPage" style="position:relative;">
    <!-- è¯­è¨€åˆ‡æ¢ï¼ˆç™»å½•é¡µå³ä¸Šè§’ï¼‰-->
    <div class="login-lang-toggle">
        <button class="login-lang-btn active" id="loginLangZh" onclick="setLang('zh')">ä¸­æ–‡</button>
        <button class="login-lang-btn" id="loginLangEn" onclick="setLang('en')">EN</button>
    </div>
    <div class="login-hero">
        <div class="login-logo-icon">ğŸ™</div>
        <div class="login-app-name" data-i18n="appName">åŒå£°ä¼ è¯‘</div>
        <div class="login-tagline" data-i18n="loginTagline">æ‰«ç å³å¯å®æ—¶æŸ¥çœ‹å­—å¹•<br>æ”¯æŒå¤šè¯­è¨€ç¿»è¯‘</div>
        <div class="login-badge" data-i18n="loginBadge">ğŸ“± æ‰‹æœºå­—å¹•æŸ¥çœ‹ç«¯</div>
    </div>
    <div class="login-card">
        <button class="login-sso-btn" onclick="login()" data-i18n="loginBtn">å£°ç½‘è´¦å· SSO ç™»å½•</button>
        <div class="login-hint" data-i18n="loginHint">å®‰å…¨ç™»å½• Â· æ•°æ®åŠ å¯†ä¼ è¾“</div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• ä¸»ç•Œé¢ â•â•â•â•â•â•â•â•â•â• -->
<div class="main-page" id="mainPage">

    <!-- é¡¶éƒ¨æ  -->
    <header class="topbar">
        <div class="topbar-logo" onclick="handleLogoClick()">
            <div class="topbar-logo-icon">ğŸ™</div>
            <span class="topbar-logo-text">åŒå£°ä¼ è¯‘</span>
        </div>

        <div class="topbar-center">
            <div class="channel-badge" id="channelBadge" style="display:none;" onclick="copyChannelId()">
                <span class="channel-badge-label" data-i18n="channel">é¢‘é“</span>
                <span class="channel-badge-value" id="displayChannelId"></span>
                <span style="font-size:10px;opacity:0.5;">ğŸ“‹</span>
            </div>
        </div>

        <div class="topbar-right">
            <div class="settings-wrap" id="settingsWrap">
                <button class="settings-btn" onclick="toggleSettingsMenu(event)" title="è®¾ç½®">âš™ï¸</button>
                <div class="settings-dropdown" id="settingsDropdown">
                    <!-- è¯­è¨€åˆ‡æ¢ -->
                    <div class="settings-dropdown-section" data-i18n="settingsLangLabel">ç•Œé¢è¯­è¨€</div>
                    <div class="settings-lang-row">
                        <button class="settings-lang-btn active" id="settingsLangZh" onclick="setLang('zh');event.stopPropagation()">ä¸­æ–‡</button>
                        <button class="settings-lang-btn" id="settingsLangEn" onclick="setLang('en');event.stopPropagation()">English</button>
                    </div>
                    <!-- é€€å‡ºï¼ˆä»…åŠ å…¥é¢‘é“åæ˜¾ç¤ºï¼‰-->
                    <div class="settings-divider" id="settingsExitDivider" style="display:none;"></div>
                    <button class="settings-dropdown-item danger" id="settingsExitBtn" style="display:none;" onclick="confirmExit();closeSettingsMenu()">
                        <span class="item-icon">ğŸšª</span>
                        <span data-i18n="exitBtn">é€€å‡ºé¢‘é“</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- åŠ å…¥å‰ï¼šçº¯æ‰«ç  -->
    <div class="join-screen" id="joinScreen">
        <div class="qr-scanner-frame">
            <div class="qr-scanner-inner">
                <div class="qr-corner tl"></div>
                <div class="qr-corner tr"></div>
                <div class="qr-corner bl"></div>
                <div class="qr-corner br"></div>
                <div class="qr-scan-line"></div>
                <div class="qr-scan-icon">â—¼</div>
            </div>
        </div>
        <div class="join-title" data-i18n="scanTitle">æ‰«ç åŠ å…¥å­—å¹•é¢‘é“</div>
        <div class="join-desc" data-i18n="scanDesc" style="margin-bottom:32px;">ä½¿ç”¨ç›¸æœºæ‰«ææ¡Œé¢ç«¯å±•ç¤ºçš„äºŒç»´ç <br>è‡ªåŠ¨åŠ å…¥å¹¶å®æ—¶æŸ¥çœ‹å­—å¹•</div>
        <button class="scan-btn" onclick="triggerQRScan()">
            <span class="scan-btn-icon">ğŸ“·</span>
            <span data-i18n="scanBtn">æ‰“å¼€ç›¸æœºæ‰«ç </span>
        </button>
    </div>

    <!-- å­—å¹•åŒº -->
    <div class="subtitle-screen" id="subtitleScreen">
        <div class="subtitle-toolbar">
            <div class="subtitle-status">
                <div class="status-dot"></div>
                <span data-i18n="liveSubtitle">å®æ—¶å­—å¹•</span>
            </div>
            <div class="display-pill">
                <button class="display-pill-btn active" id="modeBtnBoth"
                    onclick="setDisplayMode('both')" data-i18n="modeBoth">åŸæ–‡+è¯‘æ–‡</button>
                <button class="display-pill-btn" id="modeBtnTransOnly"
                    onclick="setDisplayMode('translationOnly')" data-i18n="modeTransOnly">ä»…è¯‘æ–‡</button>
            </div>
        </div>
        <div class="subtitle-list" id="subtitleList"></div>
    </div>

    <div class="safe-bottom"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- äºŒç»´ç å¼¹çª—ï¼ˆå±•ç¤ºç»™åˆ«äººæ‰«ï¼‰-->
<div class="qr-modal" id="qrModal" onclick="closeQRModal(event)">
    <div class="qr-modal-content" onclick="event.stopPropagation()">
        <div class="qr-handle"></div>
        <div class="qr-title" data-i18n="qrTitle">é‚€è¯·ä»–äººæŸ¥çœ‹å­—å¹•</div>
        <div class="qr-subtitle" data-i18n="qrSubtitle">æ‰«æä¸‹æ–¹äºŒç»´ç ï¼Œå³å¯åœ¨æ‰‹æœºç«¯å®æ—¶æŸ¥çœ‹å­—å¹•</div>
        <div class="qr-placeholder">â—¼</div>
        <div class="qr-channel-row">
            <span>é¢‘é“å·</span>
            <span class="qr-channel-value" id="qrChannelValue">â€”</span>
            <span onclick="copyChannelId()" style="cursor:pointer;font-size:15px;">ğŸ“‹</span>
        </div>
        <button class="qr-close-btn" onclick="closeQRModal()" data-i18n="qrClose">å…³é—­</button>
    </div>
</div>

<!-- å¼€å‘è€…æ¨¡å¼å¼¹çª— -->
<div class="dev-modal" id="devModal">
    <div class="dev-content">
        <div class="dev-handle"></div>
        <div class="dev-title" data-i18n="devTitle">ğŸ›  å¼€å‘è€…æ¨¡å¼</div>
        <div class="dev-option">
            <div class="dev-option-row">
                <div>
                    <div class="dev-option-title" data-i18n="devTimeLimitTitle">ç§»é™¤ 10 åˆ†é’Ÿä½“éªŒæ—¶é—´é™åˆ¶</div>
                    <div class="dev-option-desc" data-i18n="devTimeLimitDesc">å¼€å¯åæœ¬æ¬¡é€šè¯æ— æ—¶é—´é™åˆ¶</div>
                </div>
                <div class="switch" id="noTimeLimitSwitch" onclick="toggleNoTimeLimit()"></div>
            </div>
        </div>
        <button class="dev-close" onclick="closeDevModal()" data-i18n="devClose">å…³é—­</button>
    </div>
</div>

<script>
    // â”€â”€â”€ çŠ¶æ€ â”€â”€â”€
    const state = {
        isLoggedIn: false,
        inSession: false,
        channelId: '',
        userId: '',
        displayMode: 'both',
        remainingSeconds: 600,
        timerInterval: null,
        noTimeLimitEnabled: false,
        logoClickCount: 0,
        logoClickTimer: null,
        subtitles: [],
        lang: 'zh'
    };

    // â”€â”€â”€ i18n â”€â”€â”€
    const i18n = {
        zh: {
            appName:      'åŒå£°ä¼ è¯‘',
            loginTagline: 'æ‰«ç å³å¯å®æ—¶æŸ¥çœ‹å­—å¹•<br>æ”¯æŒå¤šè¯­è¨€ç¿»è¯‘',
            loginBadge:   'ğŸ“± æ‰‹æœºå­—å¹•æŸ¥çœ‹ç«¯',
            loginBtn:     'å£°ç½‘è´¦å· SSO ç™»å½•',
            loginHint:    'å®‰å…¨ç™»å½• Â· æ•°æ®åŠ å¯†ä¼ è¾“',
            scanTitle:    'æ‰«ç åŠ å…¥å­—å¹•é¢‘é“',
            scanDesc:     'ä½¿ç”¨ç›¸æœºæ‰«ææ¡Œé¢ç«¯å±•ç¤ºçš„äºŒç»´ç <br>è‡ªåŠ¨åŠ å…¥å¹¶å®æ—¶æŸ¥çœ‹å­—å¹•',
            scanBtn:      'æ‰“å¼€ç›¸æœºæ‰«ç ',
            channel:      'é¢‘é“',
            exitBtn:          'é€€å‡ºé¢‘é“',
            settingsLangLabel:'ç•Œé¢è¯­è¨€',
            liveSubtitle: 'å®æ—¶å­—å¹•',
            modeBoth:     'åŸæ–‡+è¯‘æ–‡',
            modeTransOnly:'ä»…è¯‘æ–‡',
            loginSuccess: 'ç™»å½•æˆåŠŸ',
            joinedChannel:'å·²åŠ å…¥é¢‘é“ ',
            leftChannel:  'å·²é€€å‡ºé¢‘é“',
            scanningTip:  'æ­£åœ¨è°ƒç”¨ç›¸æœºâ€¦ï¼ˆæ¼”ç¤ºï¼šæ¨¡æ‹Ÿæ‰«ç æˆåŠŸï¼‰',
            channelCopied:'é¢‘é“å·å·²å¤åˆ¶',
            copyFailed:   'å¤åˆ¶å¤±è´¥',
            confirmExit:  'ç¡®å®šé€€å‡ºå½“å‰å­—å¹•é¢‘é“ï¼Ÿ',
            timeLimitOff: 'å·²ç§»é™¤æ—¶é—´é™åˆ¶',
            timeLimitOn:  'å·²æ¢å¤ 10 åˆ†é’Ÿé™åˆ¶',
            timeUp:       'ä½“éªŒæ—¶é—´å·²åˆ°ï¼Œå·²é€€å‡ºé¢‘é“',
            noSubtitle:   'æš‚æ— å­—å¹•',
            devTitle:     'ğŸ›  å¼€å‘è€…æ¨¡å¼',
            devTimeLimitTitle: 'ç§»é™¤ 10 åˆ†é’Ÿä½“éªŒæ—¶é—´é™åˆ¶',
            devTimeLimitDesc:  'å¼€å¯åæœ¬æ¬¡é€šè¯æ— æ—¶é—´é™åˆ¶',
            devClose:     'å…³é—­',
            qrTitle:      'é‚€è¯·ä»–äººæŸ¥çœ‹å­—å¹•',
            qrSubtitle:   'æ‰«æä¸‹æ–¹äºŒç»´ç ï¼Œå³å¯åœ¨æ‰‹æœºç«¯å®æ—¶æŸ¥çœ‹å­—å¹•',
            qrClose:      'å…³é—­'
        },
        en: {
            appName:      'Interpretation',
            loginTagline: 'Scan QR to view live subtitles<br>Multi-language translation',
            loginBadge:   'ğŸ“± Mobile Subtitle Viewer',
            loginBtn:     'Agora SSO Login',
            loginHint:    'Secure Login Â· Encrypted Transmission',
            scanTitle:    'Scan to Join Subtitle Channel',
            scanDesc:     'Scan the QR code shown on the desktop<br>to join and view subtitles in real time',
            scanBtn:      'Open Camera to Scan',
            channel:      'Channel',
            exitBtn:          'Leave Channel',
            settingsLangLabel:'Interface Language',
            liveSubtitle: 'Live Subtitles',
            modeBoth:     'Original + Translation',
            modeTransOnly:'Translation Only',
            loginSuccess: 'Login successful',
            joinedChannel:'Joined channel ',
            leftChannel:  'Left channel',
            scanningTip:  'Opening cameraâ€¦ (Demo: simulating scan)',
            channelCopied:'Channel ID copied',
            copyFailed:   'Copy failed',
            confirmExit:  'Are you sure you want to exit the subtitle channel?',
            timeLimitOff: 'Time limit removed',
            timeLimitOn:  '10-minute limit restored',
            timeUp:       'Time is up, exited channel',
            noSubtitle:   'No subtitles yet',
            devTitle:     'ğŸ›  Developer Mode',
            devTimeLimitTitle: 'Remove 10-min Time Limit',
            devTimeLimitDesc:  'Unlimited call duration when enabled',
            devClose:     'Close',
            qrTitle:      'Invite Others to View',
            qrSubtitle:   'Scan the QR code below to view subtitles on mobile',
            qrClose:      'Close'
        }
    };

    function t(key) { return i18n[state.lang][key] || i18n.zh[key] || key; }

    function setLang(lang) {
        state.lang = lang;
        // åŒæ­¥æ‰€æœ‰è¯­è¨€æŒ‰é’®
        document.getElementById('loginLangZh')?.classList.toggle('active', lang === 'zh');
        document.getElementById('loginLangEn')?.classList.toggle('active', lang === 'en');
        document.getElementById('settingsLangZh')?.classList.toggle('active', lang === 'zh');
        document.getElementById('settingsLangEn')?.classList.toggle('active', lang === 'en');

        // æ›´æ–°æ‰€æœ‰ data-i18n å…ƒç´ 
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            const val = t(key);
            if (key === 'loginTagline' || key === 'scanDesc') {
                el.innerHTML = val;
            } else {
                el.textContent = val;
            }
        });
        // åŒæ­¥å¼€å‘è€…å¼¹çª—æ–‡æ¡ˆ
        const devTitleEl = document.querySelector('.dev-title');
        if (devTitleEl) devTitleEl.textContent = t('devTitle');
        const devCloseEl = document.querySelector('.dev-close');
        if (devCloseEl) devCloseEl.textContent = t('devClose');
    }

    // â”€â”€â”€ ç™»å½• â”€â”€â”€
    function login() {
        setTimeout(() => {
            state.isLoggedIn = true;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'flex';
            showToast(t('loginSuccess'), 'success');
        }, 400);
    }

    // â”€â”€â”€ æ‰«ç åŠ å…¥ï¼ˆæ¼”ç¤ºæ¨¡æ‹Ÿï¼‰â”€â”€â”€
    function triggerQRScan() {
        showToast(t('scanningTip'), 'info');
        // æ¨¡æ‹Ÿæ‰«ç æˆåŠŸå»¶è¿Ÿ
        setTimeout(() => {
            const demoChannel = Math.floor(10000000 + Math.random() * 90000000).toString();
            joinChannel(demoChannel);
        }, 1500);
    }

    function joinChannel(channelId) {
        state.channelId = channelId;
        state.userId = 'Viewer-' + Math.floor(1000 + Math.random() * 9000);
        state.inSession = true;
        state.remainingSeconds = 600;

        document.getElementById('displayChannelId').textContent = state.channelId;
        document.getElementById('qrChannelValue').textContent = state.channelId;
        document.getElementById('channelBadge').style.display = 'flex';

        document.getElementById('joinScreen').style.display = 'none';
        document.getElementById('subtitleScreen').classList.add('active');
        _syncSettingsExitVisibility(true);

        startTimer();
        startSimulateSubtitles();
        showToast(t('joinedChannel') + state.channelId, 'success');
    }

    // â”€â”€â”€ é€€å‡º â”€â”€â”€
    function confirmExit() {
        if (confirm(t('confirmExit'))) exitSession();
    }

    function exitSession() {
        state.inSession = false;
        stopTimer();
        clearSubtitles();

        document.getElementById('channelBadge').style.display = 'none';
        document.getElementById('subtitleScreen').classList.remove('active');
        document.getElementById('joinScreen').style.display = 'flex';
        _syncSettingsExitVisibility(false);
        showToast(t('leftChannel'), 'info');
    }

    // â”€â”€â”€ æ˜¾ç¤ºæ¨¡å¼ â”€â”€â”€
    function setDisplayMode(mode) {
        state.displayMode = mode;
        document.getElementById('modeBtnBoth').classList.toggle('active', mode === 'both');
        document.getElementById('modeBtnTransOnly').classList.toggle('active', mode === 'translationOnly');
        document.body.classList.toggle('subtitle-original-hidden', mode === 'translationOnly');
    }

    // â”€â”€â”€ å¤åˆ¶é¢‘é“å· â”€â”€â”€
    function copyChannelId() {
        if (!state.channelId) return;
        navigator.clipboard.writeText(state.channelId).then(() => {
            showToast(t('channelCopied'), 'success');
        }).catch(() => showToast(t('copyFailed'), 'error'));
    }

    // â”€â”€â”€ è®¡æ—¶å™¨ï¼ˆå·²ç§»é™¤å€’è®¡æ—¶ UIï¼Œä¿ç•™ç©ºå‡½æ•°é˜²æŠ¥é”™ï¼‰â”€â”€â”€
    function startTimer() {}
    function stopTimer() {
        if (state.timerInterval) { clearInterval(state.timerInterval); state.timerInterval = null; }
    }

    // â”€â”€â”€ å­—å¹•æ¨¡æ‹Ÿ â”€â”€â”€
    let subtitleInterval;

    function startSimulateSubtitles() {
        clearInterval(subtitleInterval);
        const users = ['Emmaï¼ˆä¸»è®²ï¼‰', state.userId];
        const samples = [
            { zh: 'å¤§å®¶å¥½ï¼Œæ¬¢è¿å‚åŠ ä»Šå¤©çš„å›½é™…æŠ€æœ¯å³°ä¼šï¼Œæˆ‘ä»¬å°†æ¢è®¨å®æ—¶é€šä¿¡é¢†åŸŸçš„æœ€æ–°è¿›å±•ã€‚', en: 'Hello everyone, welcome to today\'s international technology summit. We will explore the latest developments in real-time communications.' },
            { zh: 'å®æ—¶è¯­éŸ³è½¬å½•å’Œç¿»è¯‘æŠ€æœ¯æ­£åœ¨æ”¹å˜æˆ‘ä»¬çš„è·¨è¯­è¨€æ²Ÿé€šæ–¹å¼ï¼Œæ•ˆç‡æå‡éå¸¸æ˜¾è‘—ã€‚', en: 'Real-time speech transcription and translation technology is transforming how we communicate across languages, with remarkable efficiency gains.' },
            { zh: 'è¿™å¥—ç³»ç»ŸåŸºäºå…ˆè¿›çš„äººå·¥æ™ºèƒ½ç®—æ³•ï¼Œå¯ä»¥å®ç°æ¯«ç§’çº§çš„ç¿»è¯‘å“åº”ï¼Œéå¸¸é€‚åˆä¼šè®®åœºæ™¯ã€‚', en: 'This system is based on advanced AI algorithms and achieves millisecond-level translation response, ideal for conference scenarios.' },
            { zh: 'æˆ‘ä»¬çš„è¯­éŸ³è¯†åˆ«å‡†ç¡®ç‡å·²ç»è¶…è¿‡äº†95%ï¼Œå³ä½¿åœ¨å˜ˆæ‚çš„ç¯å¢ƒä¸‹ä¹Ÿèƒ½ä¿æŒé«˜è´¨é‡è¾“å‡ºã€‚', en: 'Our speech recognition accuracy has exceeded 95%, maintaining high-quality output even in noisy environments.' },
            { zh: 'æ¥ä¸‹æ¥æˆ‘ä¼šå±•ç¤ºå‡ ä¸ªå®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼Œè¯·å¤§å®¶ç•™æ„å­—å¹•åŒºåŸŸçš„å®æ—¶ç¿»è¯‘æ•ˆæœã€‚', en: 'Next, I will demonstrate several real-world use cases. Please pay attention to the real-time translation in the subtitle area.' },
            { zh: 'æ„Ÿè°¢å„ä½çš„ç§¯æå‚ä¸ï¼Œä½ ä»¬çš„åé¦ˆå¯¹æˆ‘ä»¬ä¸æ–­ä¼˜åŒ–äº§å“è‡³å…³é‡è¦ã€‚', en: 'Thank you all for your active participation. Your feedback is crucial for our continuous product improvement.' }
        ];
        let index = 0;
        subtitleInterval = setInterval(() => {
            const isMe = index % 4 === 3;
            const user = isMe ? users[1] : users[0];
            const sample = samples[index % samples.length];
            addSubtitle(user, sample.zh, sample.en, isMe);
            index++;
        }, 3000);
    }

    function addSubtitle(user, original, translation, isMe) {
        const list = document.getElementById('subtitleList');
        const time = new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
        const seed = isMe ? (state.userId || 'viewer').toLowerCase().replace(/[^a-z0-9]/g, '') : 'emma';
        const avatarUrl = `https://api.dicebear.com/7.x/avataaars/svg?seed=${seed}`;

        const item = document.createElement('div');
        item.className = 'subtitle-item';
        item.innerHTML = `
            <div class="subtitle-user-row">
                <div class="subtitle-avatar"><img src="${avatarUrl}" alt="${user}" loading="lazy"></div>
                <span class="subtitle-username">${user}</span>
                <span class="subtitle-time">${time}</span>
            </div>
            <div class="subtitle-bubble">
                <div class="subtitle-original">${original}</div>
                <div class="subtitle-translation">${translation}</div>
            </div>`;
        list.appendChild(item);
        list.scrollTop = list.scrollHeight;
        if (list.children.length > 60) list.removeChild(list.firstChild);

        state.subtitles.push({ user, original, translation, time });
    }

    function clearSubtitles() {
        clearInterval(subtitleInterval);
        const list = document.getElementById('subtitleList');
        if (list) list.innerHTML = '';
        state.subtitles = [];
    }

    // â”€â”€â”€ äºŒç»´ç å¼¹çª— â”€â”€â”€
    function showQRModal() {
        document.getElementById('qrModal').classList.add('show');
    }

    function closeQRModal(event) {
        if (!event || event.target.classList.contains('qr-modal')) {
            document.getElementById('qrModal').classList.remove('show');
        }
    }

    // â”€â”€â”€ Logo ç‚¹å‡» 5 æ¬¡ â†’ å¼€å‘è€…æ¨¡å¼ â”€â”€â”€
    function handleLogoClick() {
        state.logoClickCount++;
        if (state.logoClickTimer) clearTimeout(state.logoClickTimer);
        if (state.logoClickCount >= 5) {
            openDevModal();
            state.logoClickCount = 0;
        } else {
            state.logoClickTimer = setTimeout(() => { state.logoClickCount = 0; }, 2000);
        }
    }

    function openDevModal() { document.getElementById('devModal').classList.add('active'); }
    function closeDevModal() { document.getElementById('devModal').classList.remove('active'); }

    // â”€â”€â”€ è®¾ç½®èœå• â”€â”€â”€
    function toggleSettingsMenu(e) {
        e && e.stopPropagation();
        document.getElementById('settingsDropdown').classList.toggle('open');
    }
    function closeSettingsMenu() {
        document.getElementById('settingsDropdown').classList.remove('open');
    }
    // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­èœå•
    document.addEventListener('click', () => closeSettingsMenu());

    function _syncSettingsExitVisibility(inChannel) {
        const show = !!inChannel;
        document.getElementById('settingsExitBtn').style.display = show ? '' : 'none';
        document.getElementById('settingsExitDivider').style.display = show ? '' : 'none';
    }

    function toggleNoTimeLimit() {
        const sw = document.getElementById('noTimeLimitSwitch');
        state.noTimeLimitEnabled = sw.classList.toggle('active');
        if (state.noTimeLimitEnabled) {
            stopTimer();
            showToast(t('timeLimitOff'), 'success');
        } else {
            if (state.inSession) startTimer();
            showToast(t('timeLimitOn'), 'info');
        }
    }

    // â”€â”€â”€ Toast â”€â”€â”€
    function showToast(msg, type = 'info') {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.className = `toast ${type} show`;
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // â”€â”€â”€ åˆå§‹åŒ– â”€â”€â”€
    window.onload = function() {
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('mainPage').style.display = 'none';
    };
</script>
</body>
</html>
